<link rel="stylesheet" type="text/css" href="/style.css" />
<script src="/axios.js"></script>

<pre>
<p>Emojicount: <span id="emojicount"></span></p>
<p>Open Channels: <span id="openchannels"></span></p>
</pre>

<script>
  const emojicount = document.getElementById('emojicount')
  const openchannels = document.getElementById('openchannels')
  let emojicountData
  let openchannelsData

  async function main() {
    emojicountData = (await axios.get('https://api.vnft.cc/emoji/count')).data
    emojicount.innerHTML = emojicountData

    openchannelsData = (await axios.get('https://api.vnft.cc/emoji/status/open')).data
  }

  async function render() {
    openchannels.innerHTML = openchannelsDisplay(openchannelsData)
  }

  function openchannelsDisplay(channels) {
    let response = {}
    channels = channels.sort((a, b) => a.channel_id > b.channel_id)
    for (let i in channels) {
      let channel = channels[i]

      let entity = {}
      entity['last fetch'] = `${(new Date() - new Date(channel.last_fetch)) / 1000}s ago`
      entity['last message'] = channel.last_message_id

      response[channel.channel_id] = entity
    }
    return JSON.stringify(response, null, 2)
  }

  main()
  setInterval(main, 10 * 1000)
  render()
  setInterval(render, 100)
</script>
