<meta content="Discord - Free Voice and Text Chat" property="og:title">
<meta content="All-in-one voice and text chat for gamers that's free, secure, and works on both your desktop and phone.
Stop paying for TeamSpeak servers and hassling with Skype. Simplify your life." property="og:description">
<meta content='https://discordapp.com/assets/ba74954dde74ff40a32ff58069e78c36.png' property='og:image'>

<meta name="theme-color" content="#7289DA">
<meta name="twitter:card" content="summary_large_image">
<link type="application/json+oembed" href="./embed.json" />

<link rel="stylesheet" type="text/css" href="./index.css" />
<script src="/axios.js"></script>

<div id="siteContainer">
  <input id="searchbox" type="text" />
  <input onclick="searchprefix('lead')" value="lead" type="button" />
  <input onclick="searchprefix('latest')" value="latest" type="button" />
  <div id="mainContainer"></div>
</div>

<script>
  let search = document.location.search.substr(1)

  var mainContainer = document.getElementById('mainContainer')
  var searchbox = document.getElementById('searchbox')
  searchbox.value = search

  var currentSearch = ''
  var typingSearch = ''
  var page = 0
  var site = ''

  async function loop() {
    if (currentSearch != searchbox.value) {
      if (typingSearch == searchbox.value) {
        rebuildList()
      }
      typingSearch = searchbox.value
    }
    if (window.scrollMaxY - window.scrollY < 100 && page != -1) {
      page++
      let wasEmpty = await addEmojisFromGET()
      if (wasEmpty == true) {
        page = -1
      }
    }
  }

  async function rebuildList() {
    mainContainer.innerHTML = ''
    currentSearch = searchbox.value
    page = 0
    window.history.pushState('emoji', 'Title', '/emoji/?' + currentSearch)

    if (searchbox.value == '' || searchbox.value == '!lead') {
      site = 'https://api.vnft.cc/emoji/lead'
    } else if (searchbox.value == '!latest') {
      site = 'https://api.vnft.cc/emoji/last'
    } else {
      site = `https://api.vnft.cc/emoji/search/${searchbox.value}`
    }

    addEmojisFromGET()
  }

  async function addEmojisFromGET(url = `${site}/${page}`) {
    let wasEmpty = true
    let emojis = await axios.get(url)
    for (let emoji of emojis.data) {
      wasEmpty = false
      let emojiElement = createEmojiElement(emoji)
      mainContainer.appendChild(emojiElement)
    }
    return wasEmpty
  }

  function createEmojiElement(emoji) {
    let div = document.createElement('div')
    let el = document.createElement('img')
    div.appendChild(el)

    div.className = 'parent'
    el.className = 'img'

    el.src = emoji.url
    el.title = emoji.name

    return div
  }

  function searchprefix(a) {
    searchbox.value = '!' + a
  }

  rebuildList()
  setInterval(loop, 500)
</script>
